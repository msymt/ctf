# malloc(3)

malloc()はプログラム内で必要なメモリを動的に確保したい場合に使う。
そのメモリの確保する縫合を探る。

malloc()は通常、プロセスのアドレス空間のうちヒープという領域を利用する。
まず特定サイズのヒープ領域を空きプールとして確保し、sbrk()を使って、現在のヒープ領域を拡張する。
そして、領域が足りなくなると随時sbrk()を発行して確保する。

そして、`malloc()`はプロセスから要求されたサイズに応じて`malloc()`の管理する`chunk`という単位で確保したプールからメモリを切り出す。
要求側には`chunk`の管理部を除いた領域の先頭アドレスを返す。
またmalloc()ではヒープ領域以外にも条件によりmmap()システムコールで確保した領域を利用する。

malloc()によって確保されたメモリはfree()により解放するが、実際にはその時点でヒープ領域が減少する訳ではない。未使用となったchunkは未使用リストにリンクされ管理される。そして次に要求のあった時に必要に応じて再利用される。
