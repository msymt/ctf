# ヒープ問題を解くためにメモした事

## ヒープとは
ヒープは全てのプログラムに割り当てられたメモリ領域である。
スタックとは異なり、動的に割り当てることが可能。
これは、プログラムが必要な時にヒープセグメントからメモリの**要求**と**解放**することができると言う意味である。
このメモリはグローバルで、プログラム内なら、何処からでもアクセスや変更が可能である。
また、割り当てられている関数にローカライズされない。

## 動的メモリを使ってみる

`stdlib.h`は標準ライブラリ関数を配布しており、動的メモリのアクセス、変更、管理を行う。通常`malloc`や`free`もある。

```
// dynamically allocate 10 bytes
char *buffer = (char *)malloc(10);

strcpy(buffer, "hello");
printf("%s\n", buffer);

free(buffer);
```
`malloc`や`free`といった関数が、標準ライブラリから与えられていることに注意したい。
これらの関数は, 我々のような開発者とヒープメモリを効率的に管理するOSとの間に立つ。

一度だけ使用した後に割り当てられたメモリを解放(`free`)するのは開発者の責任。
内部では、これらの関数は`sbrk`や`mmap`を呼び出し、OSからヒープメモリを要求、解放をする。

## glibc のheapを探ってみる
まず、以下の事に留意する.
1. `size_t`の代わりに`INTERNAL_SIZE_T`を内部で使う.
2. `Alignment`は`2 * (sizeof(size_t))`と定義
3. `MORECORE`はよりメモリを得るために呼び出す動作.もともと`sbrk`の事

